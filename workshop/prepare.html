<!-- title -->
<section id="home">
  <h1>Cloud Native OCI</h1>
  <h2>üíª Workshop Preparation</h2>
  include "partials/_titleSlide.html"
</section>

<!-- Prerequisites -->
<section id="prerequisites">
  <h2>Install Tools</h2>
  <div class="mu-sequence">
    <p class="mu-left mu-medium">
      The following applications are required for the workshop.
      Please üôè ensure access and/or installation ahead of time
    </p>
    <hr />

    <table class="mu-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Info</th>
          <th>Required?</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <a href="https://docs.cloud.oracle.com/iaas/Content/GSG/Tasks/signingup.htm" target="_blank">OCI Tenancy<sup>1</sup></a>
          </td>
          <td>Access to Oracle Cloud Infrastructure console and resources</td>
          <td></td>
          <td class="mu-center">‚úÖ</td>
        </tr>
        <tr>
          <td>
              <a href="https://www.docker.com/products/docker-desktop" target="_blank">Docker Desktop<sup></sup></a>
          </td>
          <td>Docker engine including Kubernetes and <code>kubectl</code></td>
          <td><a href="#k8s">‚ÑπÔ∏è</a></td>
          <td class="mu-center">‚úÖ</td>
        </tr>
        <tr>
          <td>
            <a href="https://github.com/helm/helm" target="_blank">Helm<sup></sup></a>
          </td>
          <td>
            Kubernetes Package Manager
          </td>
          <td><a href="#helm">‚ÑπÔ∏è</a></td>
          <td class="mu-center">‚úÖ</td>
        </tr>
        <tr>
          <td>
            <a href="https://docs.cloud.oracle.com/iaas/Content/API/SDKDocs/cliinstall.htm" target="_blank">OCI Command Line<sup>2</sup></a>
          </td>
          <td>
            Oracle Cloud Infrastructure command line interface
          </td>
          <td></td>
          <td class="mu-center mu-grayscale">‚úÖ</td>
        </tr>
        <tr>
          <td>
            <a href="https://svc-cat.io/docs/install/#step-2---install-service-catalog" target="_blank">svcat<sup></sup></a></a>
          </td>
          <td>
            Kubernetes Service Catalog CLI
          </td>
          <td></td>
          <td class="mu-center"></td>
        </tr>
        <tr>
          <td>
            <a href="https://stedolan.github.io/jq/" target="_blank">JSON CLI Processor<sup></sup></a></a>
          </td>
          <td>
            Command line utility for parsing JSON outputs
          </td>
          <td></td>
          <td class="mu-center"></td>
        </tr>
      </tbody>
    </table>

    <blockquote class="mu-small mu-left">
      <sup>1</sup>Tenancy access may or may not be provided. Plan to use your own.<br />
      <sup>2</sup><strong>Required</strong> if using an OKE cluster.
    </blockquote>
  </div>
</section>

<section>
  <section id="configuration">
    <h2>Configure Tenancy</h2>
    <div class="mu-small">
      <p class="mu-left">
        When a tenancy is created, an <strong>Administrators</strong> group is automatically created
        for the tenancy. Users that are members of the <strong>Administrators</strong> group can
        perform any operation on resources in the tenancy.
      </p>
      <hr />
    </div>

    <div class="mu-flex mu-small switcher">
      <ul>
        <li>OKE Policies</li>
        <li>Compartment</li>
        <li>API User</li>
        <li>User Policies</li>
        <li>Service Limits</li>
        <li>‚úÖ Checklist</li>
      </ul>
      <ul class="col-1-1">
        <!-- oke policy -->
        <li>
          Before you can use Container Engine for Kubernetes (OKE) to create and deploy
          clusters, the tenancy's <b>root compartment</b> must include a
          policy to allow OKE to perform operations in the tenancy.

          <div class="mu-margin mu-margin-top">
            <ol class="mu-medium">
              <li>Open <a href="https://console.us-phoenix-1.oraclecloud.com/a/identity/policies" target="_blank">OCI Console</a></li>
              <li>Governance and Admininstration &raquo; Identity &raquo; Policies &raquo; Create</li>
              <li><pre><code class="hljs text">Allow service OKE to manage all-resources in tenancy</code></pre></li>
            </ol>
          </div>
          <a href="https://docs.cloud.oracle.com/iaas/Content/ContEng/Concepts/contengpolicyconfig.htm" target="_blank">
            ‚ÑπÔ∏è Documentation
          </a>
        </li>
        <!-- compartment setup -->
        <li>
          Depending on the tenancy and your level of access,
          you <em>may</em> want <b>(or need)</b> to create a compartment
          dedicated to this application and the resources allocated.
 
          <div class="mu-margin mu-margin-top">
            <ol class="mu-medium">
              <li>Launch <a href="https://console.us-phoenix-1.oraclecloud.com/identity/compartments" target="_blank">OCI Console</a></li>
              <li>Governance and Admininstration &raquo; Identity &raquo; Compartments &raquo; Create</li>
              <li>
                <div class="mu-flex">
                  <label>NAME</label> <span class="mu-muted">A name for the Compartment</span>
                </div>
                <div class="mu-flex">
                  <label>DESCRIPTION</label> <span class="mu-muted">A user-friendly description</span>
                </div>
              </li>
              <li>‚úèÔ∏è Make note of the Compartment <b><code>OCID</code></b></li>
            </ol>
          </div>
          <a href="https://docs.cloud.oracle.com/iaas/Content/Identity/Tasks/managingcompartments.htm#two" target="_blank">
            ‚ÑπÔ∏è Documentation
          </a>
        </li>
        <!-- api user -->
        <li>
          You will need a User with <b>API Key</b> access in your tenancy. This can be your personal user account, or 
          a virtual user specific to usage of this application.
          <div class="mu-margin mu-margin-top">
            <ol class="mu-medium">
              <li>Open <a href="https://console.us-phoenix-1.oraclecloud.com/a/identity/users" target="_blank">OCI Console</a></li>
              <li>Governance and Admininstration &raquo; Identity &raquo; Users</li>
              <li>Select <em>or create</em> the user you wish to use</li>
              <li>If necessary, follow these 
                <a href="https://docs.cloud.oracle.com/iaas/Content/Functions/Tasks/functionssetupapikey.htm" target="_blank">instructions</a>
                to create an API key
              </li>
              <li>
                ‚úèÔ∏è Make note of the following items:
                <div>User <b><code>OCID</code></b></div>
                <div>API Key <b>Fingerprint</b></div>
              </li>
            </ol>
          </div>
        </li>
        <!-- user group policies -->
        <li>
          If your configured User (with API Key) is <em><b>not</b></em> a member
          of the Administrators Group, then a <b>Group</b> with specific Policies must be
          created, and the User added as a member
          <div class="mu-margin mu-margin-top">
            <ol class="mu-medium">
              <li>Open <a href="https://console.us-phoenix-1.oraclecloud.com/identity/groups" target="_blank">OCI Console</a></li>
              <li>Governance and Admininstration &raquo; Identity &raquo; Groups &raquo; Create</li>
              <li>Specify metadata for the Group, and make note of the <label>NAME</label></li>
              <li>Click <button class="oui-button oui-button-primary">Add User to Group</button> and select your API User</li>
              <li>Governance and Admininstration &raquo; Identity &raquo; Policies &raquo; Create</li>
              <li>
                Create a Policy with the following statement:
                <pre><code class="hljs text">Allow group &lt;GroupName&gt; to manage all-resources in compartment &lt;CompartmentName&gt;</code></pre>
                <blockquote class="mu-medium">
                  ‚ö†Ô∏è This policy is intentionally broad for the sake of simplicity, and is not recommended in most
                  real-world use cases. Refer to the
                  <a href="https://docs.cloud.oracle.com/iaas/Content/Identity/Concepts/overview.htm#three" target="_blank">Documentation</a>
                  for more on this topic.
                </blockquote>
              </li>
            </ol>
          </div>
        </li>
        <!-- service limits -->
        <li>Streaming...</li>
        <!-- checklist -->
        <li>
          Many of these tenancy configurations will be used at different times
          within the material that follows. Please create a file with the following
          information to simplify lookups later.
          <div class="mu-margin mu-margin-top">
            <pre><code class="hljs yaml">region:       # Region where resources will be provisioned. (ex: us-phoenix-1)
tenancy:      # Tenancy OCID value
user:         # API User OCID value
compartment:  # Compartment OCID value
key:          # Private API Key file path (ex: /Users/jdoe/.oci/oci_key.pem)
fingerprint:  # Public API Key fingerprint (ex: 43:65:2c...)</code></pre>
          </div>
          <blockquote class="mu-small">
            ‚ö†Ô∏è It is also recommeded to configure the OCI Command Line with using these values. Refer
            the <a href="https://docs.cloud.oracle.com/iaas/Content/API/SDKDocs/cliconfigure.htm" target="_blank">Documentation</a>
            on CLI configuration .
          </blockquote>
        </li>
      </ul>
    </div>

  </section>

</section>

<!-- K8S Setup -->
<section id="k8s" data-background-image="/images/tech/k8s.png" data-background-size="100px"
  data-background-position="20px 20px">
  <h2>Prepare Docker/K8s</h2>
  <div>
    <p class="mu-left mu-medium">
      Several exercises in the workshop require the use of Docker/Kubernetes.
      In order to run commands in a local cluster, please follow these
      instructions to setup your environment.
    </p>
    <hr />
  </div>
  <div class="mu-flex mu-small switcher">
    <ul>
      <li>Enable K8s (Mac)</li>
      <li>Enable K8s (Windows)</li>
      <li><code>kubectl</code></li>
    </ul>
    <ul class="col-1-1">
      <li><img class="plain" data-src="/images/help/enable_k8s.png" alt="Enable K8S" /></li>
      <li><img class="plain" data-src="/images/help/enable_k8s_win.png" alt="Enable K8S" /></li>
      <li class="mu-sequence">
        <p>Check <code>kubectl</code> context</p>
        <pre><code class="hljs text">kubectl config current-context</code></pre>
        <p>Create namespace</p>
        <pre><code class="hljs text">kubectl create namespace mushop</code></pre>
        <p>Set default namespace <em class="mu-muted">(optional)</em></p>
        <pre><code class="hljs text">kubectl config set-context \
  $(kubectl config current-context) \
  --namespace=mushop</code></pre>
      </li>
    </ul>
  </div>
</section>

<section id="k8s" data-background-image="/images/tech/k8s.png" data-background-size="100px"
  data-background-position="20px 20px">
  <h2>Prepare OKE Cluster</h2>

  <div class="fragment-set">
    <div class="fragment fade-out">
      <p class="mu-left mu-medium">
        In <em>addition</em> to local Kubernetes cluster, you can also create and use an OKE cluster.
        Please follow these instructions to set up an OKE cluster.
      </p>
      <hr />
    </div>
    <div class="fragment fade-in mu-flex mu-gutter">
      <div><img class="plain" width="100%" data-src="/images/k8s/console1.png"
          alt="Console - Developer Services - Container Clusters" /></div>
      <div><img class="plain" width="100%" data-src="/images/k8s/console2.png" alt="Console - Cluster List" /></div>
    </div>
    <div class="fragment fade-in mu-flex mu-gutter">
      <img class="plain" data-src="/images/k8s/create_simple_oke1.png" alt="Console - Cluster Creation" />
    </div>
    <div class="fragment fade-in mu-overflow">
      <img class="plain" data-src="/images/k8s/create_simple_oke2.png" alt="Console - Cluster Node Pool Creation" />
    </div>
  </div>
</section>

<section id="oke-kubectl">
  <h2>Access an OKE Cluster</h2>
  <ul class="mu-small">
    <li>Kubectl - Command Line Tool</li>
  </ul>
  <div class="mu-flex mu-gutter">
    <div><img class="plain fragment" width="100%" data-src="/images/k8s/kubeconfig1.png"
        alt="Console - Cluster Details" /></div>
    <div><img class="plain fragment" width="100%" data-src="/images/k8s/kubeconfig2.png"
        alt="Console - Accessing Kubeconfig" /></div>
  </div>
  <pre class="fragment"><code class="hljs text">mkdir -p $HOME/.kube</code></pre>
  <pre class="fragment"><code class="hljs text">oci ce cluster create-kubeconfig --cluster-id ocid1.cluster.oc1.phx.aaaaaaaaae3dgnlgmqzgczjsg4zgeyjzhfsggmrvmi3ggobwgczgezlcgrsg --file $HOME/.kube/config --region us-phoenix-1</code></pre>
  <pre class="fragment"><code class="hljs text">export KUBECONFIG=$HOME/.kube/config</code></pre>
</section>

<section id="oke-dashboard">
  <h2>Access an OKE Cluster</h2>
  <ul class="mu-small">
    <li>Dashboard - UI Tool</li>
  </ul>
  <img class="plain fragment" data-src="/images/k8s/dashboard.png" alt="Console - Accessing Kubernetes Dashboard" />
  <pre class="fragment"><code class="hljs text">kubectl proxy</code></pre>
  <p class="mu-small">Then click <a
      href="http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/"
      target="_blank">here</a> to access the dashboard.</p>
</section>

<section id="helm">
  <h2>Quick Install - Helm</h2>
  <div class="fragment-set mu-sequence">
    <div class="fragment fade-out">
      <p class="mu-center no-margin">MacOS or Linux</p>
      <div class="mu-medium">
        <p class="mu-small">Install Homebrew, a MacOS package manager, if not yet installed</p>
        <pre><code class="hljs shell">/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</code></pre>
        <p class="mu-small">Install Helm using this command. Will also install the optional svcat cli</p>
        <pre><code class="hljs shell">brew update && brew install kubernetes-helm kubernetes-service-catalog-client</code></pre>
        <p class="mu-small">Check if you have helm installed on the local K8s (Docker Desktop)</p>
        <pre><code class="hljs text">helm version</code></pre>
        <p class="mu-small">The Helm version command should give result similar to this:</p>
        <pre><code class="hljs shell">> helm version
Client: &version.Version{SemVer:"v2.14.3", GitCommit:"0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085", GitTreeState:"clean"}
Server: &version.Version{SemVer:"v2.14.3", GitCommit:"0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085", GitTreeState:"clean"}</code></pre>
        <p class="mu-small">If you receive an error that helm could not find tiller pod on the server, do this:</p>
        <pre><code class="hljs text">helm init --history-max 200</code></pre>
      </div>
    </div>
    <div class="fragment fade-in">
      <p class="mu-center no-margin">Windows</p>
      <div class="mu-medium">
        <p class="mu-small">Install
          <a href="https://chocolatey.org/install" target="_blank">Chocolatey</a>,
          a Windows package manager, if not yet installed
        </p>
        <p class="mu-small">Install Helm using this command</p>
        <pre><code class="hljs shell">choco install kubernetes-helm</code></pre>
        <p class="mu-small">Check if you have helm installed on the local K8s (Docker Desktop)</p>
        <pre><code class="hljs text">helm version</code></pre>
        <p class="mu-small">The Helm version command should give result similar to this:</p>
        <pre><code class="hljs shell">c:\ helm version
Client: &version.Version{SemVer:"v2.14.3", GitCommit:"0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085", GitTreeState:"clean"}
Server: &version.Version{SemVer:"v2.14.3", GitCommit:"0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085", GitTreeState:"clean"}</code></pre>
        <p class="mu-small">If you receive an error that helm could not find tiller pod on the server, do this:</p>
        <pre><code class="hljs text">helm init --history-max 200</code></pre>
      </div>
    </div>
    <div class="fragment fade-in">
      <p class="mu-center no-margin">Windows</p>
      <div class="mu-medium">
        <p class="mu-small">Install the svcat cli:</p>
        <pre><code class="hljs shell">iwr 'https://download.svcat.sh/cli/latest/windows/amd64/svcat.exe' -UseBasicParsing -OutFile svcat.exe
mkdir -f ~\bin
$env:PATH += ";${pwd}\bin"
svcat version --client</code></pre>
        <hr />
        <p class="mu-small">
          Or download the binary directly and make executable:
          <a href="https://download.svcat.sh/cli/latest/windows/amd64/svcat.exe" target="_blank">svcat.exe download</a>
        </p>
      </div>
    </div>
  </div>
</section>