<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>Cloud Native OCI - MuShop</title>
  
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/reveal.css">
  <link rel="stylesheet" href="/css/theme/mu.css">

  <!-- Theme used for syntax highlighting of code -->
  <link rel="stylesheet" href="/lib/css/monokai.css">

  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? '/css/print/pdf.css' : '/css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <!-- title -->
      <section id="home">
        <!-- landing -->
        <section id="home-title">
          <h1>Cloud Native OCI</h1>
          <h2>Storefront + Edge</h2>
          <div class="mu-flex mu-flex-center mu-flex-middle mu-margin">
            <img height="100" class="plain no-margin" data-src="/images/tech/oci.png" alt="Oracle Cloud Infrastructure" />
            <span>+</span>
            <img height="80" class="plain no-margin" data-src="/images/logo.png" alt="MuShop" />
          </div>
          <hr/>
          <small>Created with ‚ù§ by <a href="#contributors">Oracle A-Team</a></small>
        </section>

        <!-- TOC -->
        <section id="toc">
          <h2>Table of Contents</h2>
          <ul>
            <!-- add a line for each <section id="slideId">...</section>  -->
            <li><a href="#home">Home</a></li>
            <li><a href="#lab">Overview</a></li>
            <li><a href="#ingress">Ingress</a></li>
            <li><a href="#dns">DNS</a></li>
            <li><a href="#waf">WAF</a></li>
            <li><a href="#other">Additional</a></li>
            <li><a href="#resources">Resources</a></li>
          </ul>
        </section>

        <!-- Contributors -->
        <section id="contributors">
          <h2>Primary Contributors</h2>
          <div class="mu-flex mu-flex-center mu-small mu-left mu-gutter">
            <div>
              <div>Adao Oliveira Junior</div>
              <div>Jeevan Joseph</div>
              <div>Julio Camara</div>
            </div>
            <div>
              <div>Matt Vander Vliet</div>
              <div>Sherwood Zern</div>
              <div>Sumit Kumar</div>
            </div>
          </div>
        </section>
      </section>

      <!-- Overview -->
      <section id="lab">
        <h2>Lab Overview</h2>
        <ul>
          <li>Exposing the application</li>
          <li>DNS Configuration</li>
          <li>OKE Ingress</li>
          <li>Securing with WAF</li>
        </ul>
      </section>

      <section id="ingress">
        <h2>Ingress</h2>
        <p>
          Shown here is a basic service diagram for the way traffic flows to
          an application deployed on OKE
        </p>
        <div class="mu-flex mu-flex-middle">
          <div class="mu-svc fragment">
            <img data-src="/images/tech/dns.svg" />
            <span>DNS</span>
          </div>
          <!-- <div class="mu-flex-connector arrow"></div>
            <div class="mu-svc">
              <img data-src="/images/tech/waf.svg" />
              <span>WAF</span>
            </div> -->
          <div class="mu-flex-connector arrow fragment fade-in">public-ip</div>
          <div class="mu-svc fragment fade-in">
            <img data-src="/images/tech/lb.svg" />
            <span>LB</span>
          </div>
          <div class="mu-flex-connector arrow fragment fade-in">subnets</div>
          <div class="mu-svc fragment fade-in">
            <img data-src="/images/tech/vcn.svg" />
            <span>VCN</span>
          </div>
          <div class="mu-flex-connector arrow fragment fade-in">backends</div>
          <div class="mu-svc fragment fade-in">
            <img data-src="/images/tech/k8s.icon.png" />
            <span>OKE</span>
          </div>
        </div>
      </section>


      <section id="dns">
        <h2>
          <img data-src="/images/tech/dns.svg" alt="DNS" />
          DNS
        </h2>
        <blockquote class="mu-small">
          The Oracle Cloud Infrastructure Domain Name System (DNS) service lets
          you create and manage your DNS zones. You can create zones, add records
          to zones, and allow Oracle Cloud Infrastructure's edge network to handle
          your domain's DNS queries.
        </blockquote>
        <div class="fragment">
          <div>
            <img class="shadow no-margin" data-src="/images/edge/dns.console.png" style="width: 80%;"/>
          </div>
          <p class="mu-small">‚úèÔ∏è DNS Zone may also be used as part of <b>Traffic Steering Policies</b></p>
        </div>
        <!-- <pre class="fragment"><code class="hljs text">oci dns zone list</code></pre> -->
      </section>

      <section>
        <section id="k8s-ingress">
          <h2>OKE Ingress</h2>
          
           <div class="mu-flex mu-flex-middle mu-gutter mu-margin">
            <img data-src="/images/tech/k8s.png" style="width:10%"/>
            <blockquote class="mu-small">
              Ingress exposes HTTP and HTTPS routes from outside the cluster to
              services within the cluster. Traffic routing is controlled by rules
              on the <b>Ingress</b> resource
            </blockquote>
          </div>

          <div class="mu-flex mu-flex-middle">
            <div class="mu-svc">
              <img data-src="/images/tech/lb.svg" /> LB
            </div>
            <div class="mu-flex-connector arrow"></div>
            <div class="mu-svc">
              <img data-src="/images/tech/vcn.svg" /> VCN
            </div>
            <div class="mu-flex-connector arrow"></div>
            <div class="mu-svc">
              <img data-src="/images/tech/k8s.icon.png" /> OKE
            </div>
          </div>

          <div class="fragment-set">
            <div class="fragment fade-out">
              <p>Explore how this works...</p>
            </div>
            <div class="fragment">
              <p>First an ingress controller is installed</p>
              <pre><code class="hljs text">helm install \
--name nginx-ingress \
--namespace nginx-ingress \
stable/nginx-ingress</code></pre>
              <pre><code class="hljs text">kubectl get svc -n nginx-ingress</code></pre>
              <pre><code class="hljs text">NAME                       TYPE           CLUSTER-IP    EXTERNAL-IP      PORT(S)                      AGE
nginx-ingress-controller   LoadBalancer   10.96.89.25   129.146.192.154   80:32491/TCP,443:31240/TCP   5m</code></pre>
              <p class="mu-small">An <b><code>EXTERNAL-IP</code></b> is assigned after a few seconds</p>
            </div>
            <div class="fragment">
              <p>Next verify the load balancer in OCI</p>
              <pre><code class="hljs text">oci lb load-balancer list \
| jq '.data[] | {id: .id, name: .["display-name"], ipAddr: .["ip-addresses"][]["ip-address"]}'</code></pre>
              <pre><code>{
  "id": "ocid1.loadbalancer.oc1.phx.aaaaaaaaucgamttt3piveonxw5d6ssirzxprcbrcv7vf6tgswna7qxdnvnfa",
  "name": "097f5359-9165-11e9-bfe8-0a580aed21e9",
  "ipAddr": "129.146.192.154"
}</code></pre>
              <p class="mu-small">Notice üëÄ <b><code>ipAddr</code></b> matches <b><code>EXTERNAL-IP</code></b> assigned to the controller ü§ò</p>
            </div>
            <div class="fragment mu-ratio mu-ratio-2-1">
							<div>
								<p class="no-margin">
									Then deploy ingress on the cluster
								</p>
								<pre class="mu-xsmall"><code class="hljs text">kubectl apply -f deploy/kubernetes/ingress/mushop-dev.yaml</code></pre>
								<pre class="mu-xsmall"><code class="hljs yaml">apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: mushop-dev
  annotations:
    kubernetes.io/ingress.class: nginx
spec:
  rules:
  - http:
      paths:
      - path: /
        backend:
          serviceName: edge
          servicePort: 80</code></pre>
              	<pre class="mu-xsmall"><code class="hljs text">kubectl get ingress mushop-dev</code></pre>
            	</div>
            </div>
          </div>
        </section>
      </section>

      <!-- WAF -->
      <section>
        <section id="waf">
          <h2>üîí Web Application Firewall</h2>
          <blockquote class="mu-small">
              The WAF service uses a layered approach to protect web applications
              against cyberattacks. This service includes over 250 predefined
              Open Web Access Security Project (OWASP), application, and
              compliance-specific rules.
          </blockquote>
          <div class="fragment fade-in">
            <img class="no-margin" data-src="/images/edge/waf.png" alt="WAF" style="width: 75%;"/>
            <p class="mu-xsmall no-margin">OCI Web Application Acceleration and Security Services</p>
          </div>
        </section>

        <section id="waf-ingress">
          <h2>Ingress with WAF</h2>
          <p>
            WAF security added between DNS and load balancer
          </p>
          <div class="mu-flex mu-flex-middle">
            <div class="mu-svc mu-grayscale">
              <img data-src="/images/tech/dns.svg" /> DNS
            </div>
            <div class="mu-flex-connector arrow">CNAME</div>
            <div class="mu-svc">
              <img data-src="/images/tech/waf.svg" /> üîí WAF
            </div>
            <div class="mu-flex-connector arrow">public-ip</div>
            <div class="mu-svc mu-grayscale">
              <img data-src="/images/tech/lb.svg" /> LB
            </div>
            <div class="mu-flex-connector arrow"></div>
            <div class="mu-svc mu-grayscale">
              <img data-src="/images/tech/vcn.svg" /> VCN
            </div>
            <div class="mu-flex-connector arrow"></div>
            <div class="mu-svc mu-grayscale">
              <img data-src="/images/tech/k8s.icon.png" /> OKE
            </div>
          </div>
        </section>

        <section id="waf-console">
          <h2>WAF in OCI Console</h2>
          <img class="shadow no-margin" data-src="/images/edge/waf.console.png"/>
          <pre clas="fragment"><code class="hljs text">oci waas waas-policy list</code></pre>
        </section>

        <section id="waf-console-rules">
          <h2>WAF Protection Rules</h2>
          <p class="mu-small">
            Applying protection to a WAF origin is done by choosing specific rules
						from <b>OWASP <a href="https://modsecurity.org/crs/" target="_blank">Core Rule Set (CRS)</a></b>,
						where the action can be set
            to <span class="mu-warning">Detect</span>,
            <span class="mu-danger">Block</span>, or
            <span class="mu-muted">Off</span>
          </p>
          <img class="shadow no-margin fragment" data-src="/images/edge/waf.protection.rules.png"/>
        </section>

        <section id="waf-console-access">
          <h2>WAF Access Rules </h2>
          <p class="mu-small">
            Custom access rules can also be defined based on a set of specified
            condition(s). Choosing the associative action, error code, and handling
            are defined as well
          </p>
          <div class="fragment-set">
            <div class="fragment">
              <img class="shadow no-margin" data-src="/images/edge/waf.access.region.png"/>
              <p class="mu-small no-margin">
                ‚òùÔ∏è Here access from Ireland is <span class="mu-danger">blocked</span>
                <span class="mu-muted">(sorry üçÄ, demo purposes)</span>
              </p>
            </div>
            <div class="fragment fade-in">
              <img class="shadow no-margin" data-src="/images/edge/waf.block.geo.png"/>
              <p class="mu-small no-margin">
                üëø <a href="https://geopeeker.com/fetch/?url=https%3A%2F%2Fmushop.ateam.cloud" target="_blank">Try It</a>
              </p>
            </div>
          </div>
        </section>
			</section>
			
			<section>
				<section id="waf-demo">
					<h2>WAF Demo</h2>
					<div class="mu-flex mu-flex-middle">
						<div class="mu-svc">
							<span class="mu-svc-icon">üëø</span>
						</div>
						<div class="mu-flex-connector arrow">attacker</div>
						<div class="mu-svc">
							<img data-src="/images/tech/dns.svg" /> DNS
						</div>
						<div class="mu-flex-connector arrow">CNAME</div>
						<div class="mu-svc">
							<img data-src="/images/tech/waf.svg" /> WAF
						</div>
						<div class="mu-flex-connector arrow">403</div>
						<div class="mu-svc">
							<span class="mu-svc-icon">üö´</span>
						</div>
					</div>

					<a href="https://mushop.ateam.cloud" target="_blank">
						<img data-src="/images/logo.png" />
					</a>
				</section>

				<section id="waf-verify">
					<h2>Verify WAF Edge</h2>

					<pre><code class="hljs sh">curl -I -X GET https://mushop.ateam.cloud</code></pre>
					<pre><code class="hljs text">content-type: text/html
vary: Accept-Encoding
x-cache-status: NOTCACHED
date: Sun, 23 Jun 2019 12:35:57 GMT
etag: W/"5d0b92c0-5fe5"
server: ZENEDGE
strict-transport-security: max-age=15724800; includeSubDomains
x-zen-fury: b9c90d1625d96f0414ad23c9562ea95ef6e80ed7
last-modified: Thu, 20 Jun 2019 14:05:52 GMT
x-cdn: Served-By-Zenedge</code></pre>
				<p class="mu-small fragment">We see <code>server: ZENEDGE</code> so WAF is working ‚úÖ</p>
				</section>

				<section id="waf-protect">
					<h2>DEMO: OWASP Core Rule Set</h2>
					<p class="mu-small">
						For sake of demonstration, let's use the application search bar to 
						attempt some attacks from the  MuShop user interface. Try the following
						by entering text into the search field
					</p>
					<blockquote class="mu-small">
						‚ö†Ô∏è It may also be useful to open Chrome Developer Tools Network tab
					</blockquote>
					<div class="mu-sequence">
						<div class="fragment">
							SQL injection
							<pre><code class="hljs text">;DROP TABLE users</code></pre>
						</div>
						<div class="fragment">
							XSS
							<pre><code class="hljs text">&lt;script&gt;alert('bad');&lt;/script&gt;</code></pre>
						</div>
					</div>
					<pre></pre>
				</section>

				<section id="waf-access">
					<h2>DEMO: WAF Access Control</h2>
					<div class="mu-flex mu-small mu-margin">
						<div class="col-1-2">
							<span class="mu-icon mu-large block">üîê</span>
							<a target="_blank" href="https://mushop.ateam.cloud">https://mushop.ateam.cloud</a>
						</div>
						<div class="col-1-2">
							<span class="mu-icon mu-large block mu-muted">üîì</span>
							<a class="mu-danger" target="_blank" href="https://insecure.mushop.ateam.cloud">https://insecure.mushop.ateam.cloud</a>
						</div>
					</div>
					<img class="shadow no-margin fragment" data-src="/images/edge/waf.access.rules.png"/>
				</section>
			</section>

      <section id="other">
        <h2>Other Edge Services</h2>
        <div class="mu-flex mu-gutter">
          <div class="col-1-2 fragment">
            <h4>Health Checks</h4>
            <p class="mu-small">
              Provides users with high frequency external monitoring to determine
              the availability and performance of any publicly facing service,
              including hosted websites, API endpoints, or externally facing load balancers
            </p>
            <img class="shadow no-margin" data-src="/images/edge/health.history.png" />
          </div>
          <div class="col-1-2 fragment">
            <h4 class="no-wrap">Traffic Steering</h4>
            <p class="mu-small">
              Configure policies to serve intelligent responses to DNS queries,
              meaning <b>different answers (endpoints)</b> may be served for the query
              depending on the logic the customer defines in the policy.
            </p>
            <hr/>
            <p class="mu-small no-margin">
              ‚òùÔ∏è Is directly connected to <b>DNS</b> and <b>Health Check</b>
              services!
            </p>
          </div>
        </div>
      </section>

      <section id="resources">
        <h2>Resources</h2>
        <ul>
          <li><a href="https://docs.cloud.oracle.com/iaas/Content/Balance/Concepts/balanceoverview.htm">Load Balancer Overview</a></li>
          <li><a href="https://docs.cloud.oracle.com/iaas/Content/WAF/Concepts/gettingstarted.htm">Getting Started with WAF</a></li>
          <li><a href="https://docs.cloud.oracle.com/iaas/Content/HealthChecks/Concepts/healthchecks.htm">Health Checks Overview</a></li>
          <li><a href="https://docs.cloud.oracle.com/iaas/Content/TrafficManagement/Concepts/overview.htm">Traffic Steering Policies Service</a></li>
        </ul>
      </section>

      <!-- Use this for markdown slides
      <section data-markdown>
        <script type="text/template">
          ## markdown
        </script>
      </section>
      -->

    </div>
  </div>
  <!-- ateam stamp / home -->
  <a href="#home" class="mu-ateam-water">
    <img src="/images/ateam.png" />
  </a>

  <script src="/js/reveal.js"></script>

  <script>
    // More info about config & dependencies:
    // - https://github.com/hakimel/reveal.js#configuration
    // - https://github.com/hakimel/reveal.js#dependencies
    Reveal.initialize({
      history: true,
      fragmentInURL: true,
      transition: 'slide',
      dependencies: [
        { src: '/plugin/markdown/marked.js' },
        { src: '/plugin/markdown/markdown.js' },
        { src: '/plugin/clipboard/copy.js', async: true },
        { src: '/plugin/notes/notes.js', async: true },
        { src: '/plugin/highlight/highlight.js', async: true }
      ]
    });
  </script>
</body>

</html>